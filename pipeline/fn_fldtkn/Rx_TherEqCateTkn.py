import pandas as pd

import numpy as np

column_to_top_values = {'ther_eq_hierarchy_name': ['Antihyperglycemic - Glucagon-Like Peptide-1 (GLP-1) Receptor Agonists', 'Antihyperlipidemic - HMG CoA Reductase Inhibitors (statins)', 'Insulin Response Enhancers - Biguanides', 'Antihyperglycemic - Sodium Glucose Cotransporter-2 (SGLT2) Inhibitors', 'Insulin Analogs - Long Acting', 'ACE Inhibitors', 'Gastric Acid Secretion Reducer - Proton Pump Inhibitors (PPIs)', 'Angiotensin II Receptor Blockers (ARBs)', 'Anticonvulsant - GABA Analogs', 'Antihyperglycemic - Sulfonylurea Derivatives', 'Calcium Channel Blockers - Dihydropyridines', 'Beta Blockers Cardiac Selective', 'Medical Supplies and DME - Glucose Monitoring Test Supplies', 'Antidepressant - Selective Serotonin Reuptake Inhibitors (SSRIs)', 'Thyroid Hormones - Synthetic T4 (Thyroxine)', 'Vitamins - D Derivatives', 'Medical Supplies and DME - Blood Glucose Tests', 'Skeletal Muscle Relaxant - Central Muscle Relaxants', 'Asthma/COPD Therapy - Beta 2-Adrenergic Agents, Inhaled, Short Acting', 'Insulin Analogs - Rapid Acting', 'Diuretic - Thiazides and Related', 'Antihyperglycemic - Dual GIP and GLP-1 Receptor Agonists', 'Analgesic Opioid Hydrocodone and Non-Salicylate Combinations', 'Antidepressant - Serotonin-Norepinephrine Reuptake Inhibitors (SNRIs)', 'Antihistamines - 2nd Generation', 'Diuretic - Loop', 'Analgesic Opioid Agonists', 'Glucocorticoids', 'NSAID Analgesics (COX Non-Specific) - Propionic Acid Derivatives', 'Nasal Corticosteroids'], 'ther_eq_parent_name': ['Injectable Antidiabetic Agents', 'Antihyperlipidemics', 'Antihyperglycemic - Insulin Response Enhancers', 'Antidepressants', 'Medical Supplies and DME-Glucose Monitoring and Insulin Admin Supplies', 'Antihyperglycemic - Sodium Glucose Cotransporter Inhibitors', 'Gastric Acid Secretion Reducing Agents - Antisecretory Agents', 'Insulin - Human and Analogs, Long Acting', 'Anticonvulsants', 'ACE Inhibitors and ACE Inhibitor Combinations', 'Angiotensin II Receptor Blocker (ARBs) and ARB Combinations', 'Antihyperglycemic - Insulin-Release Stimulant Type', 'Calcium Channel Blockers', 'Thyroid Hormones and Combinations', 'Beta Blockers Cardiac Selective, All', 'NSAID Analgesics (Cyclooxygenase Inhibitors-Non-Selective)', 'Vitamins - Oil Soluble', 'Skeletal Muscle Relaxants', 'Antianxiety Agents', 'Insulin - Human and Analogs, Short or Rapid Acting', 'Asthma/COPD Therapy - Beta Adrenergic Agents', 'Diuretic - Thiazides and Related, and Combinations', 'Antihistamines', 'Analgesic Opioid Hydrocodone Combinations', 'Platelet Aggregation Inhibitors and Combinations', 'Diuretic - Loop and Combinations', 'Analgesic - Opioid Agonists and Combinations', 'Glucocorticoids and Combinations', 'Nasal Preparations', 'Angiotensin II Receptor Blockers (ARBs) Combinations'], 'ther_eq_ult_parent_name': ['Endocrine', 'Cardiovascular Therapy Agents', 'Central Nervous System Agents', 'Respiratory Therapy Agents', 'Gastrointestinal Therapy Agents', 'Analgesic, Anti-inflammatory or Antipyretic', 'Medical Supplies and Durable Medical Equipment (DME)', 'Anti-Infective Agents', 'Electrolyte Balance-Nutritional Products', 'Dermatological', 'Locomotor System', 'Hematological Agents', 'Genitourinary Therapy', 'Eating Disorder Therapy', 'Drugs to treat Erectile Dysfunction', 'Gout and Hyperuricemia Therapy', 'Chemical Dependency, Agents to Treat', 'Ophthalmic Agents', 'Antiseptics and Disinfectants', 'Otic (Ear)', 'Cognitive Disorder Therapy', 'Vaginal Products', 'Mouth-Throat-Dental - Preparations', 'Contraceptives', 'Antineoplastics', 'Biologicals', 'Anorectal Preparations', 'Antidotes and other Reversal Agents', 'Alternative Therapy', 'Immunosuppressive Agents']}

idx2tkn = ['ther_eq_hierarchy_name_unk', 'ther_eq_hierarchy_name_minor', 'ther_eq_hierarchy_name_Antihyperglycemic - Glucagon-Like Peptide-1 (GLP-1) Receptor Agonists', 'ther_eq_hierarchy_name_Antihyperlipidemic - HMG CoA Reductase Inhibitors (statins)', 'ther_eq_hierarchy_name_Insulin Response Enhancers - Biguanides', 'ther_eq_hierarchy_name_Antihyperglycemic - Sodium Glucose Cotransporter-2 (SGLT2) Inhibitors', 'ther_eq_hierarchy_name_Insulin Analogs - Long Acting', 'ther_eq_hierarchy_name_ACE Inhibitors', 'ther_eq_hierarchy_name_Gastric Acid Secretion Reducer - Proton Pump Inhibitors (PPIs)', 'ther_eq_hierarchy_name_Angiotensin II Receptor Blockers (ARBs)', 'ther_eq_hierarchy_name_Anticonvulsant - GABA Analogs', 'ther_eq_hierarchy_name_Antihyperglycemic - Sulfonylurea Derivatives', 'ther_eq_hierarchy_name_Calcium Channel Blockers - Dihydropyridines', 'ther_eq_hierarchy_name_Beta Blockers Cardiac Selective', 'ther_eq_hierarchy_name_Medical Supplies and DME - Glucose Monitoring Test Supplies', 'ther_eq_hierarchy_name_Antidepressant - Selective Serotonin Reuptake Inhibitors (SSRIs)', 'ther_eq_hierarchy_name_Thyroid Hormones - Synthetic T4 (Thyroxine)', 'ther_eq_hierarchy_name_Vitamins - D Derivatives', 'ther_eq_hierarchy_name_Medical Supplies and DME - Blood Glucose Tests', 'ther_eq_hierarchy_name_Skeletal Muscle Relaxant - Central Muscle Relaxants', 'ther_eq_hierarchy_name_Asthma/COPD Therapy - Beta 2-Adrenergic Agents, Inhaled, Short Acting', 'ther_eq_hierarchy_name_Insulin Analogs - Rapid Acting', 'ther_eq_hierarchy_name_Diuretic - Thiazides and Related', 'ther_eq_hierarchy_name_Antihyperglycemic - Dual GIP and GLP-1 Receptor Agonists', 'ther_eq_hierarchy_name_Analgesic Opioid Hydrocodone and Non-Salicylate Combinations', 'ther_eq_hierarchy_name_Antidepressant - Serotonin-Norepinephrine Reuptake Inhibitors (SNRIs)', 'ther_eq_hierarchy_name_Antihistamines - 2nd Generation', 'ther_eq_hierarchy_name_Diuretic - Loop', 'ther_eq_hierarchy_name_Analgesic Opioid Agonists', 'ther_eq_hierarchy_name_Glucocorticoids', 'ther_eq_hierarchy_name_NSAID Analgesics (COX Non-Specific) - Propionic Acid Derivatives', 'ther_eq_hierarchy_name_Nasal Corticosteroids', 'ther_eq_parent_name_unk', 'ther_eq_parent_name_minor', 'ther_eq_parent_name_Injectable Antidiabetic Agents', 'ther_eq_parent_name_Antihyperlipidemics', 'ther_eq_parent_name_Antihyperglycemic - Insulin Response Enhancers', 'ther_eq_parent_name_Antidepressants', 'ther_eq_parent_name_Medical Supplies and DME-Glucose Monitoring and Insulin Admin Supplies', 'ther_eq_parent_name_Antihyperglycemic - Sodium Glucose Cotransporter Inhibitors', 'ther_eq_parent_name_Gastric Acid Secretion Reducing Agents - Antisecretory Agents', 'ther_eq_parent_name_Insulin - Human and Analogs, Long Acting', 'ther_eq_parent_name_Anticonvulsants', 'ther_eq_parent_name_ACE Inhibitors and ACE Inhibitor Combinations', 'ther_eq_parent_name_Angiotensin II Receptor Blocker (ARBs) and ARB Combinations', 'ther_eq_parent_name_Antihyperglycemic - Insulin-Release Stimulant Type', 'ther_eq_parent_name_Calcium Channel Blockers', 'ther_eq_parent_name_Thyroid Hormones and Combinations', 'ther_eq_parent_name_Beta Blockers Cardiac Selective, All', 'ther_eq_parent_name_NSAID Analgesics (Cyclooxygenase Inhibitors-Non-Selective)', 'ther_eq_parent_name_Vitamins - Oil Soluble', 'ther_eq_parent_name_Skeletal Muscle Relaxants', 'ther_eq_parent_name_Antianxiety Agents', 'ther_eq_parent_name_Insulin - Human and Analogs, Short or Rapid Acting', 'ther_eq_parent_name_Asthma/COPD Therapy - Beta Adrenergic Agents', 'ther_eq_parent_name_Diuretic - Thiazides and Related, and Combinations', 'ther_eq_parent_name_Antihistamines', 'ther_eq_parent_name_Analgesic Opioid Hydrocodone Combinations', 'ther_eq_parent_name_Platelet Aggregation Inhibitors and Combinations', 'ther_eq_parent_name_Diuretic - Loop and Combinations', 'ther_eq_parent_name_Analgesic - Opioid Agonists and Combinations', 'ther_eq_parent_name_Glucocorticoids and Combinations', 'ther_eq_parent_name_Nasal Preparations', 'ther_eq_parent_name_Angiotensin II Receptor Blockers (ARBs) Combinations', 'ther_eq_ult_parent_name_unk', 'ther_eq_ult_parent_name_minor', 'ther_eq_ult_parent_name_Endocrine', 'ther_eq_ult_parent_name_Cardiovascular Therapy Agents', 'ther_eq_ult_parent_name_Central Nervous System Agents', 'ther_eq_ult_parent_name_Respiratory Therapy Agents', 'ther_eq_ult_parent_name_Gastrointestinal Therapy Agents', 'ther_eq_ult_parent_name_Analgesic, Anti-inflammatory or Antipyretic', 'ther_eq_ult_parent_name_Medical Supplies and Durable Medical Equipment (DME)', 'ther_eq_ult_parent_name_Anti-Infective Agents', 'ther_eq_ult_parent_name_Electrolyte Balance-Nutritional Products', 'ther_eq_ult_parent_name_Dermatological', 'ther_eq_ult_parent_name_Locomotor System', 'ther_eq_ult_parent_name_Hematological Agents', 'ther_eq_ult_parent_name_Genitourinary Therapy', 'ther_eq_ult_parent_name_Eating Disorder Therapy', 'ther_eq_ult_parent_name_Drugs to treat Erectile Dysfunction', 'ther_eq_ult_parent_name_Gout and Hyperuricemia Therapy', 'ther_eq_ult_parent_name_Chemical Dependency, Agents to Treat', 'ther_eq_ult_parent_name_Ophthalmic Agents', 'ther_eq_ult_parent_name_Antiseptics and Disinfectants', 'ther_eq_ult_parent_name_Otic (Ear)', 'ther_eq_ult_parent_name_Cognitive Disorder Therapy', 'ther_eq_ult_parent_name_Vaginal Products', 'ther_eq_ult_parent_name_Mouth-Throat-Dental - Preparations', 'ther_eq_ult_parent_name_Contraceptives', 'ther_eq_ult_parent_name_Antineoplastics', 'ther_eq_ult_parent_name_Biologicals', 'ther_eq_ult_parent_name_Anorectal Preparations', 'ther_eq_ult_parent_name_Antidotes and other Reversal Agents', 'ther_eq_ult_parent_name_Alternative Therapy', 'ther_eq_ult_parent_name_Immunosuppressive Agents']

def tokenizer_fn(rec, fldtkn_args):
    column_to_top_values = fldtkn_args[f'column_to_top_values']
    
    d = {}
    for key in column_to_top_values:
        top_values = column_to_top_values[key]
        value = rec.get(key, 'unk')
        if value not in top_values and value != 'unk': value = 'minor'
        key_value = f"{key}_{value}"  # Concatenate key and value
        d[key_value] = 1

    tkn = list(d.keys())
    wgt = list(d.values())
    output = {'tkn': tkn, 'wgt': wgt}
    return output


MetaDict = {
	"column_to_top_values": column_to_top_values,
	"idx2tkn": idx2tkn,
	"tokenizer_fn": tokenizer_fn
}